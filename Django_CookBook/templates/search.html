{% extends 'default.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/search.css' %}">
{% endblock %}

{% block navbar %}
    {% include "includes/navbars/main_navbar.html" %}
{% endblock %}

{% block content %}


<div class="main-content">
    <div class="content-area">
        <!-- Поисковая строка -->
        <div class="search-container">
            <form method="get" action="{% url 'recipe_search' %}" class="search-form">
                <input type="text" name="q" placeholder="Введите название блюда или имя автора" value="{{ search_query }}">
                <button type="submit" class="btn submit-btn">Найти</button>
            </form>
        </div>

        <!-- Блок с рецептами -->
        {% if recipes %}
        <div class="recipe-grid recipe-grid--main" id="recipe-list">
            {% for recipe in recipes %}
            <div class="recipe-card">
                <img src="{{ recipe.picture.url }}" class="recipe-img recipe-img--h200" alt="{{ recipe.dish_name}}">
                <div class="recipe-title">{{ recipe.dish_name }}</div>
                <div class="recipe-rating">Рейтинг: <b>{{ recipe.average_rating }} </b>⭐️</div>
                <div>{{ recipe.preview }}</div>
                <a href="{{ recipe.get_absolute_url }}" class="btn primary-btn">Посмотреть рецепт</a>
            </div>
            {% endfor %}
        </div>
        {% else %}

        <div class="empty-message">
            <p>Запрос не оправдал ожиданий. Проверьте название или имя автора, и проявите кулинарную снисходительность.</p>
        </div>
        {% endif %}

        <!-- Пагинация -->
        {% if is_paginated %}
             <ul class="pagination">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1">Первая</a>
                    </li>

                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">←</a>
                    </li>

                {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">Первая</span>
                    </li>

                    <li class="page-item disabled">
                        <span class="page-link">←</span>
                    </li>
                {% endif %}

            <li class="page-item active">
                <span class="page-link">
                    {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
                </span>
            </li>

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}">→</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Последняя</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">→</span>
                </li>
                <li class="page-item disabled">
                    <span class="page-link">Последняя</span>
                </li>
            {% endif %}
        </ul>
    {% endif %}
    </div>

     <!-- Сайдбар с категориями -->
    <div class="sidebar">
        <h3 class="sidebar-title">Сортировка по категориям</h3>
        <ul class="category-list">
            <li>
                <a href="{% url 'recipe_search' %}"
                   class="{% if not request.GET.category %}active-category{% endif %}">
                    Все категории
                </a>
            </li>
            {% for category in categories %}
            <li>
                <a href="{% url 'recipe_search' %}?category={{ category.id }}"
                   class="{% if request.GET.category|default:'' == category.id|stringformat:'s' %}active-category{% endif %}">
                    {{ category.category }}
                </a>
            </li>
            {% endfor %}
        </ul>

        <div class="sidebar-image">
            <img src="{% static 'pictures/search_girl.png' %}"/>
        </div>
    </div>
</div>
{% endblock %}
