{% extends 'default.html' %}
{% load static %}

{% block extra_css %}
<style>
    .login-wrapper {
        display: grid;
        grid-template-columns: 1fr 2fr;
        margin-top: 20px;
        padding: 20px;
        position: relative;
    }

    .citation {
        grid-column: span 2;
        text-align: center;
        font-family: 'Playfair Display', serif;
        font-style: italic;
        font-weight: bold;
        font-size: 24px;
        margin-bottom: 20px;
        color: #2E2E2E;
    }

     .login-left {
        text-align: center;
        position: relative;
    }

    .form-error {
        color: #b51619;
        padding: 10px 12px;
        margin: 12px 0;
        font-size: 14px;
    }

     .login-image img {
        max-width: 90%;
        height: auto;
        margin-left: 100px;
    }

    .form-box {
        width: 420px;
        margin: 20px auto;
        background-color: #fdf5e6;
        padding: 40px;
        border: 1px solid #a77b5d;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .form-title {
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        font-style: italic;
        margin-bottom: 25px;
        color: rgb(102, 13, 12);
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        font-weight: bold;
        margin-bottom: 8px;
        display: block;
        color: #3e2c20;
    }

    .form-input {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid #a77b5d;
        border-radius: 6px;
        font-size: 15px;
        background-color: #fff9f0;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .form-input:focus {
        border-color: #8b5e3c;
        box-shadow: 0 0 10px rgba(139, 94, 60, 0.3);
        outline: none;
    }

    .form-error {
        color: #b51619;
        font-size: 13px;
        margin-top: 6px;
    }

    .login-btn {
        display: block;
        margin-left: auto;
        margin-top: 30px;
        background-color: rgb(102, 13, 12);
        color: rgb(246, 246, 246);
        border: 1px solid black;
        border-radius: 5px;
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        text-decoration: none;
        transition: transform 0.3s ease, text-shadow 0.3s ease;
        cursor: pointer;
    }

    .login-btn:hover {
       transform: scale(1.1);
       text-shadow: 0 0 8px rgba(255, 255, 255, 0.9);
    }

    .login-extra {
        text-align: center;
        margin-top: 20px;
        font-weight: bold;
    }

    .login-extra a {
        display: inline-block;
        color: rgb(102, 13, 12);
        font-size: 16px;
        text-decoration: none;
        transition: transform 0.3s ease;
    }

    .login-extra a:hover {
        color: #871817;
        text-decoration: none;
        transform: scale(1.1);
        text-shadow: 0 0 15px rgba(255, 255, 255, 1);
    }

    .password-toggle {
        position: absolute;
        right: 10px;
        top: 60%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        backdrop-filter: blur(5px);
        background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
        background-color: white;
        margin: 15% auto;
        padding: 20px;
        border-radius: 10px;
        width: 400px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

</style>
{% endblock %}

{% block navbar %}
    {% include "includes/navbars/minimal_navbar.html" %}
{% endblock %}

{% block content %}
<div class="main-content">
    <div class="login-wrapper">

        <span class="citation">¬´–†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞!¬ª</span>

        <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º -->
        <div class="login-left">
        <div class="login-image">
            <img src="{% static 'pictures/login.png' %}" alt="–í—Ö–æ–¥">
        </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div class="form-box">
            <h2 class="form-title">–í—Ö–æ–¥</h2>

            <form method="post">
                {% csrf_token %}

                <!-- –û—à–∏–±–∫–∏ —Ñ–æ—Ä–º—ã -->
                {% if form.errors %}
                    <div class="form-error" role="alert" aria-live="polite">
                        <strong>–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:</strong> –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
                    </div>
                {% endif %}

                <div class="form-group">
                    <label for="id_username" class="form-label">Email</label>
                    <input type="email" name="username" id="id_username"
                    class="form-input" required
                    value="{{ form.username.value|default:'' }}">
                </div>

                <!-- –ü–∞—Ä–æ–ª—å —Å –≥–ª–∞–∑–∏–∫–æ–º -->
                <div class="form-group" style="position: relative;">
                    <label for="id_password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" name="password" id="id_password"
                           class="form-input" required>
                    <button type="button" class="password-toggle" onclick="togglePassword()">üëÅÔ∏è</button>
                </div>

                <button type="submit" class="login-btn">
                    –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —É—é—Ç–Ω—ã–π –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–π –º–∏—Ä ü•ß
                </button>
            </form>

            <div class="login-extra">
                <a href="#" id="forgot-password-link">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a> |
                <a href="{% url 'signup' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è </a>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è -->
<div id="resetModal" class="modal" style="display:none;">
  <div class="modal-content">
    <p id="resetMessage"></p>
    <button onclick="closeModal()">–û–ö</button>
  </div>
</div>

<script>
    // ----- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è -----
    function togglePassword() {
        const passwordInput = document.getElementById('id_password');
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
    }

    document.getElementById("forgot-password-link").addEventListener("click", function(e) {
        e.preventDefault();
        const email = document.getElementById("id_username").value;
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        fetch("{% url 'password_reset' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": csrftoken,
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({ email })
        })
        .then(res => res.json())
        .then(data => {
            const msg = data.success
                ? "–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–π email –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –º—ã –æ—Ç–ø—Ä–∞–≤–∏–º –ø–∏—Å—å–º–æ —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è üì©."
                : data.error;
            document.getElementById("resetMessage").innerText = msg;
            document.getElementById("resetModal").style.display = "block";
        })
        .catch(err => console.error("–û—à–∏–±–∫–∞:", err));
    });


    function closeModal() {
        document.getElementById("resetModal").style.display = "none";
    }

</script>

{% endblock %}