{% extends 'default.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/login.css' %}">
{% endblock %}

{% block navbar %}
    {% include "includes/navbars/minimal_navbar.html" %}
{% endblock %}

{% block content %}
<div class="main-content">
    <div class="login-wrapper">

        <span class="citation">¬´–†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞!¬ª</span>

        <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º -->
        <div class="left">
            <img src="{% static 'pictures/login.png' %}" alt="–í—Ö–æ–¥">
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div class="form-box">
            <h2 class="form-title">–í—Ö–æ–¥</h2>

            <form method="post">
                {% csrf_token %}

                <!-- –û—à–∏–±–∫–∏ —Ñ–æ—Ä–º—ã -->
                {% if form.errors %}
                    <div class="form-error" role="alert" aria-live="polite">
                        <strong>–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:</strong> –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
                    </div>
                {% endif %}

                <div class="form-group">
                    <label for="id_username" class="form-label">Email</label>
                    <input type="email" name="username" id="id_username"
                    class="form-input" required
                    value="{{ form.username.value|default:'' }}">
                </div>

                <!-- –ü–∞—Ä–æ–ª—å —Å –≥–ª–∞–∑–∏–∫–æ–º -->
                <div class="form-group" style="position: relative;">
                    <label for="id_password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" name="password" id="id_password"
                           class="form-input" required>
                    <button type="button" class="password-toggle password-toggle--login" onclick="togglePassword()">üëÅÔ∏è</button>
                </div>

                <button type="submit" class="btn submit-btn btn-center">
                    –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —É—é—Ç–Ω—ã–π –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–π –º–∏—Ä ü•ß
                </button>
            </form>

            <div class="login-extra">
                <a href="#" id="forgot-password-link">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a> |
                <a href="{% url 'signup' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è </a>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è -->
<div id="resetModal" class="modal" style="display:none;">
  <div class="modal-content">
    <p id="resetMessage"></p>
    <button onclick="closeModal()" class="btn primary-btn">–û–ö</button>
  </div>
</div>

<script>
    // ----- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è -----
    function togglePassword() {
        const passwordInput = document.getElementById('id_password');
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
    }

    document.getElementById("forgot-password-link").addEventListener("click", function(e) {
        e.preventDefault();
        const email = document.getElementById("id_username").value;
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        fetch("{% url 'password_reset' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": csrftoken,
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({ email })
        })
        .then(res => res.json())
        .then(data => {
            const msg = data.success
                ? "–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–π email –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –º—ã –æ—Ç–ø—Ä–∞–≤–∏–º –ø–∏—Å—å–º–æ —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è üì©."
                : data.error;
            document.getElementById("resetMessage").innerText = msg;
            document.getElementById("resetModal").style.display = "block";
        })
        .catch(err => console.error("–û—à–∏–±–∫–∞:", err));
    });


    function closeModal() {
        document.getElementById("resetModal").style.display = "none";
    }

</script>

{% endblock %}